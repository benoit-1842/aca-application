function prepareEvents(){window.requestUpdate=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){window.setTimeout(a,1E3/60)}}();window.addEventListener("resize",function(){RENDER.WIDTH=window.innerWidth;RENDER.HEIGHT=window.innerHeight;RENDER.CANVAS.width=RENDER.WIDTH;RENDER.CANVAS.height=RENDER.HEIGHT},!1);window.addEventListener("mousemove",function(a){a=
    getMousePos(RENDER.CANVAS,a);KERNAL.MOUSE_X=a.x;KERNAL.MOUSE_Y=a.y},!1);window.addEventListener("keydown",function(a){key[a.keyCode]=!0;console.log("keyboard: "+a.keyCode+"pressed")},!1);window.addEventListener("keyup",function(a){key[a.keyCode]=!1},!1);window.addEventListener("mousedown",function(a){a=null==a?event:a;var b=1;a.which?(3==a.which&&(b=2),2==a.which&&(b=4)):a.button&&(2==a.button&&(b=2),4==a.button&&(b=4));return mouseButton[b]=!0});window.addEventListener("mouseup",function(a){a=null==
a?event:a;var b=1;a.which?(3==a.which&&(b=2),2==a.which&&(b=4)):a.button&&(2==a.button&&(b=2),4==a.button&&(b=4));mouseButton[b]=!1;return!0});window.addEventListener("contextmenu",function(a){void 0!=a.preventDefault&&a.preventDefault();void 0!=a.stopPropagation&&a.stopPropagation();return!1});mouseButton=[];key=[];for(var b=0;255>b;b+=1)key[b]=!1}function getMousePos(b,a){var c=b.getBoundingClientRect();return{x:a.clientX-c.left,y:a.clientY-c.top}}
Projection={set:function(b,a,c,d,e){dX=a[0]-b[0];dY=a[1]-b[1];dZ=a[2]-b[2];mm=Math.sqrt(dX*dX+dY*dY+dZ*dZ);dX/=mm;dY/=mm;dZ/=mm;uX=c[0];uY=c[1];uZ=c[2];mm=uX*dX+uY*dY+uZ*dZ;uX-=mm*dX;uY-=mm*dY;uZ-=mm*dZ;mm=Math.sqrt(uX*uX+uY*uY+uZ*uZ);uX/=mm;uY/=mm;uZ/=mm;tFOV=Math.tan(d*Math.PI/360);uX*=tFOV;uY*=tFOV;uZ*=tFOV;vX=uY*dZ-dY*uZ;vY=uZ*dX-dZ*uX;vZ=uX*dY-dX*uY;vX*=e;vY*=e;vZ*=e},toWorld:function(b,a){var c,d,e,f;c=2*b[0]/RENDER.WIDTH-1;d=1-2*b[1]/RENDER.HEIGHT;e=dX+uX*d+vX*c;f=dY+uY*d+vY*c;c=dZ+uZ*d+vZ*
    c;return 0!=c?[a[0]-a[2]*e/c,a[1]-a[2]*f/c,0]:[a[0]-a[2]*e,a[1]-a[2]*f,0]},toScreen:function(b,a){var c,d,e,f,g;c=b[0]-a[0];d=b[1]-a[1];e=b[2]-a[2];f=c*dX+d*dY+e*dZ;return 0<f?(c/=f,d/=f,e/=f,f=(c*vX+d*vY+e*vZ)/Math.pow(RENDER.WIDTH/RENDER.HEIGHT*tFOV,2),g=(f+1)/2*RENDER.WIDTH,f=(c*uX+d*uY+e*uZ)/Math.pow(tFOV,2),c=(1-f)/2*RENDER.HEIGHT,[g,c,!0]):[0,0,!1]}};function vecFromVecs(b,a){var c=vecDist(b,a);return[(b[0]-a[0])/c,(b[1]-a[1])/c,(b[2]-a[2])/c]}
function vecNorm(b){var a=vecDist(b,[0,0,0]);return[b[0]/a,b[1]/a,b[2]/a]}function vecDist(b,a){return Math.sqrt(Math.pow(b[0]-a[0],2)+Math.pow(b[1]-a[1],2)+Math.pow(b[2]-a[2],2))}function vecMagnitude(b){return Math.sqrt(Math.pow(b[0],2)+Math.pow(b[1],2)+Math.pow(b[2],2))}function vecAdd(b,a){return[b[0]+a[0],b[1]+a[1],b[2]+a[2]]}function vecSub(b,a){return[b[0]-a[0],b[1]-a[1],b[2]-a[2]]}function vecMult(b,a){return[b[0]*a[0],b[1]*a[1],b[2]*a[2]]}
function vecDiv(b,a){return[b[0]/a[0],b[1]/a[1],b[2]/a[2]]}function vecRotX(b,a){a*=Math.PI/180;return[b[0],b[1]*Math.cos(a)-b[2]*Math.sin(a),b[1]*Math.sin(a)+b[2]*Math.cos(a)]}function vecRotY(b,a){a*=Math.PI/180;return[b[0]*Math.cos(a)+b[2]*Math.sin(a),b[1],-b[0]*Math.sin(a)+b[2]*Math.cos(a)]}function vecRotZ(b,a){a*=Math.PI/180;return[b[0]*Math.cos(a)-b[1]*Math.sin(a),b[0]*Math.sin(a)+b[1]*Math.cos(a),b[2]]}
function vecLimit(b,a){var c=Math.max(Math.abs(b[0]),Math.abs(b[1]),Math.abs(b[2]))*a;return[b[0]/c,b[1]/c,b[2]/c]}function vecClamp(b,a){b[0]<-a?b[0]=-a:b[0]>a&&(b[0]=a);b[1]<-a?b[1]=-a:b[1]>a&&(b[1]=a);b[2]<-a?b[2]=-a:b[2]>a&&(b[2]=a);return b}function vecDist2d(b,a){return Math.sqrt(Math.pow(b[0]-a[0],2)+Math.pow(b[1]-a[1],2))}function debugGrid(b,a,c,d){b.beginPath();b.fillStyle="#434A59";b.fillRect(0,0,a,c);b.fill()}
function drawText(b,a,c,d,e,f){b.beginPath();b.fillStyle=d;b.textBaseline="top";b.textAlign="center";b.font="normal "+c+"px OakFont";b.fillText(a,e,f);b.fill()}function drawTextBox(b,a,c,d,e,f,g){b.beginPath();b.fillStyle="#FFF";b.font="normal "+c+"px OakFont";b.rect(e-b.measureText(a).width/2-g,f-g,b.measureText(a).width+2.5*g,c+2*g);b.fill();b.beginPath();b.fillStyle=d;b.textBaseline="top";b.textAlign="center";b.font="normal "+c+"px OakFont";b.fillText(a,e,f);b.fill()}
function sizeTriangle(b,a,c){var d,e,f,g,h,k,l,m,n;return d=a[0]-b[0],e=a[1]-b[1],f=a[2]-b[2],g=c[0]-b[0],h=c[1]-b[1],k=c[2]-b[2],l=e*k-f*h,m=f*g-d*k,n=d*h-e*g,.5*Math.sqrt(l*l+m*m+n*n)}
function rayTriangle(b,a,c,d,e){var f=(d.y-c.y)*(e.z-c.z)-(e.y-c.y)*(d.z-c.z),g=(d.z-c.z)*(e.x-c.x)-(e.z-c.z)*(d.x-c.x),h=(d.x-c.x)*(e.y-c.y)-(e.x-c.x)*(d.y-c.y),k=Math.sign(f*(c.x-b[0])+g*(c.y-b[1])+h*(c.z-b[2])),l=a[0]*f+a[1]*g+a[2]*h;if(k!=Math.sign(l)||0==k)return!1;var m=(f*c.x+g*c.y+h*c.z-(f*b[0]+g*b[1]+h*b[2]))/l,k=a[0]*m+b[0],l=a[1]*m+b[1];a=a[2]*m+b[2];var m=(c.y-l)*(d.z-a)-(d.y-l)*(c.z-a),n=(c.z-a)*(d.x-k)-(d.z-a)*(c.x-k),p=(c.x-k)*(d.y-l)-(d.x-k)*(c.y-l);if(0>m*f+n*g+p*h)return!1;m=(d.y-
    l)*(e.z-a)-(e.y-l)*(d.z-a);n=(d.z-a)*(e.x-k)-(e.z-a)*(d.x-k);p=(d.x-k)*(e.y-l)-(e.x-k)*(d.y-l);if(0>m*f+n*g+p*h)return!1;m=(e.y-l)*(c.z-a)-(c.y-l)*(e.z-a);n=(e.z-a)*(c.x-k)-(c.z-a)*(e.x-k);p=(e.x-k)*(c.y-l)-(c.x-k)*(e.y-l);return 0>m*f+n*g+p*h?!1:[k,l,a,vecDist(b,[k,l,a])]}
function drawTriangle(b,a,c,d,e,f){if(-1>=d&&vectorDist([(b.x+a.x+c.x)/3,(b.y+a.y+c.y)/3,(b.z+a.z+c.z)/3],character.position)<1+Math.abs(2*(5-d))){var g={x:(b.x+a.x)/2,y:(b.y+a.y)/2,z:(b.z+a.z)/2},h={x:(a.x+c.x)/2,y:(a.y+c.y)/2,z:(a.z+c.z)/2},k={x:(b.x+c.x)/2,y:(b.y+c.y)/2,z:(b.z+c.z)/2};drawTriangle(b,a,c,d+1,e,f);drawTriangle(b,g,k,d+1,e,f);drawTriangle(a,g,h,d+1,e,f);drawTriangle(c,h,k,d+1,e,f)}else pos0=Projection.toScreen([b.x,b.y,b.z],camera.from),RENDER.RAM[3]=Projection.toScreen([a.x,a.y,
    a.z],camera.from),RENDER.RAM[4]=Projection.toScreen([c.x,c.y,c.z],camera.from),context.beginPath(),context.fillStyle="#FEE",context.moveTo(pos0[0],pos0[1]),context.lineTo(RENDER.RAM[3][0],RENDER.RAM[3][1]),context.lineTo(RENDER.RAM[4][0],RENDER.RAM[4][1]),context.lineTo(pos0[0],pos0[1]),context.fill(),RENDER.WIREFRAME&&(context.strokeStyle="#FFF",context.stroke())}
function drawTri(b,a,c,d,e){if(e<5-Math.min(vecDist([(a[0]+a[3]+a[6])/3,(a[1]+a[4]+a[7])/3,(a[2]+a[5]+a[8])/3],b)/12,4))drawTri(b,[a[0],a[1],a[2],(a[0]+a[3])/2,(a[1]+a[4])/2,(a[2]+a[5])/2,(a[0]+a[6])/2,(a[1]+a[7])/2,(a[2]+a[8])/2],[c[0],c[1],(c[0]+c[2])/2,(c[1]+c[3])/2,(c[0]+c[4])/2,(c[1]+c[5])/2],d,e+1),drawTri(b,[a[3],a[4],a[5],(a[3]+a[6])/2,(a[4]+a[7])/2,(a[5]+a[8])/2,(a[0]+a[3])/2,(a[1]+a[4])/2,(a[2]+a[5])/2],[c[2],c[3],(c[2]+c[4])/2,(c[3]+c[5])/2,(c[0]+c[2])/2,(c[1]+c[3])/2],d,e+1),drawTri(b,
    [a[6],a[7],a[8],(a[0]+a[6])/2,(a[1]+a[7])/2,(a[2]+a[8])/2,(a[3]+a[6])/2,(a[4]+a[7])/2,(a[5]+a[8])/2],[c[4],c[5],(c[0]+c[4])/2,(c[1]+c[5])/2,(c[2]+c[4])/2,(c[3]+c[5])/2],d,e+1),drawTri(b,[(a[0]+a[6])/2,(a[1]+a[7])/2,(a[2]+a[8])/2,(a[3]+a[6])/2,(a[4]+a[7])/2,(a[5]+a[8])/2,(a[0]+a[3])/2,(a[1]+a[4])/2,(a[2]+a[5])/2],[(c[0]+c[4])/2,(c[1]+c[5])/2,(c[2]+c[4])/2,(c[3]+c[5])/2,(c[0]+c[2])/2,(c[1]+c[3])/2],d,e+1);else{RENDER.RAM[2]=Projection.toScreen([a[0],a[1],a[2]],b);RENDER.RAM[3]=Projection.toScreen([a[3],
    a[4],a[5]],b);RENDER.RAM[4]=Projection.toScreen([a[6],a[7],a[8]],b);if(!RENDER.RAM[2][2]||!RENDER.RAM[3][2]||!RENDER.RAM[4][2])return!1;RENDER.DEBUG.TRIS+=1;RENDER.CONTEXT.beginPath();RENDER.CONTEXT.fillStyle="rgba(255,25,25,1)";RENDER.CONTEXT.moveTo(RENDER.RAM[2][0],RENDER.RAM[2][1]);RENDER.CONTEXT.lineTo(RENDER.RAM[3][0],RENDER.RAM[3][1]);RENDER.CONTEXT.lineTo(RENDER.RAM[4][0],RENDER.RAM[4][1]);RENDER.CONTEXT.closePath();if(RENDER.TEXTURE){RENDER.RAM[5]=[];RENDER.RAM[5][20]=0;RENDER.RAM[5][21]=
    0;RENDER.RAM[5][22]=d.width;RENDER.RAM[5][23]=d.height;RENDER.RAM[5][8]=RENDER.RAM[2][0];RENDER.RAM[5][9]=RENDER.RAM[2][1];RENDER.RAM[5][10]=RENDER.RAM[3][0];RENDER.RAM[5][11]=RENDER.RAM[3][1];RENDER.RAM[5][12]=RENDER.RAM[4][0];RENDER.RAM[5][13]=RENDER.RAM[4][1];RENDER.RAM[5][14]=(c[0]+RENDER.RAM[5][20])*RENDER.RAM[5][22];RENDER.RAM[5][15]=(c[1]+RENDER.RAM[5][21])*RENDER.RAM[5][23];RENDER.RAM[5][16]=(c[2]+RENDER.RAM[5][20])*RENDER.RAM[5][22];RENDER.RAM[5][17]=(c[3]+RENDER.RAM[5][21])*RENDER.RAM[5][23];
    RENDER.RAM[5][18]=(c[4]+RENDER.RAM[5][20])*RENDER.RAM[5][22];RENDER.RAM[5][19]=(c[5]+RENDER.RAM[5][21])*RENDER.RAM[5][23];RENDER.RAM[5][10]-=RENDER.RAM[5][8];RENDER.RAM[5][11]-=RENDER.RAM[5][9];RENDER.RAM[5][12]-=RENDER.RAM[5][8];RENDER.RAM[5][13]-=RENDER.RAM[5][9];RENDER.RAM[5][16]-=RENDER.RAM[5][14];RENDER.RAM[5][17]-=RENDER.RAM[5][15];RENDER.RAM[5][18]-=RENDER.RAM[5][14];RENDER.RAM[5][19]-=RENDER.RAM[5][15];RENDER.RAM[5][6]=RENDER.RAM[5][16]*RENDER.RAM[5][19]-RENDER.RAM[5][18]*RENDER.RAM[5][17];
    if(0===RENDER.RAM[5][6])return;RENDER.RAM[5][7]=1/RENDER.RAM[5][6];RENDER.RAM[5][0]=(RENDER.RAM[5][19]*RENDER.RAM[5][10]-RENDER.RAM[5][17]*RENDER.RAM[5][12])*RENDER.RAM[5][7];RENDER.RAM[5][1]=(RENDER.RAM[5][19]*RENDER.RAM[5][11]-RENDER.RAM[5][17]*RENDER.RAM[5][13])*RENDER.RAM[5][7];RENDER.RAM[5][2]=(RENDER.RAM[5][16]*RENDER.RAM[5][12]-RENDER.RAM[5][18]*RENDER.RAM[5][10])*RENDER.RAM[5][7];RENDER.RAM[5][3]=(RENDER.RAM[5][16]*RENDER.RAM[5][13]-RENDER.RAM[5][18]*RENDER.RAM[5][11])*RENDER.RAM[5][7];RENDER.RAM[5][4]=
        RENDER.RAM[5][8]-RENDER.RAM[5][0]*RENDER.RAM[5][14]-RENDER.RAM[5][2]*RENDER.RAM[5][15];RENDER.RAM[5][5]=RENDER.RAM[5][9]-RENDER.RAM[5][1]*RENDER.RAM[5][14]-RENDER.RAM[5][3]*RENDER.RAM[5][15];RENDER.CONTEXT.save();RENDER.CONTEXT.clip();RENDER.CONTEXT.transform(RENDER.RAM[5][0],RENDER.RAM[5][1],RENDER.RAM[5][2],RENDER.RAM[5][3],RENDER.RAM[5][4],RENDER.RAM[5][5]);RENDER.CONTEXT.drawImage(d,0,0);RENDER.CONTEXT.restore()}else RENDER.CONTEXT.fillStyle="#F00",RENDER.CONTEXT.fill();RENDER.WIREFRAME&&(RENDER.CONTEXT.strokeStyle=
    "#FFF",RENDER.CONTEXT.stroke());RENDER.VERTEX&&(RENDER.CONTEXT.beginPath(),RENDER.CONTEXT.strokeStyle="#F00",RENDER.CONTEXT.arc(RENDER.RAM[2][0],RENDER.RAM[2][1],3,0,2*Math.PI),RENDER.CONTEXT.stroke(),RENDER.CONTEXT.beginPath(),RENDER.CONTEXT.strokeStyle="#F00",RENDER.CONTEXT.arc(RENDER.RAM[3][0],RENDER.RAM[3][1],3,0,2*Math.PI),RENDER.CONTEXT.stroke(),RENDER.CONTEXT.beginPath(),RENDER.CONTEXT.strokeStyle="#F00",RENDER.CONTEXT.arc(RENDER.RAM[4][0],RENDER.RAM[4][1],3,0,2*Math.PI),RENDER.CONTEXT.stroke())}RENDER.RAM[0]=
    0;RENDER.RAM[1]=0;RENDER.RAM[2]=0;RENDER.RAM[3]=0;RENDER.RAM[4]=0;RENDER.RAM[5]=0}
function drawQuad(b,a,c){RENDER.RAM[2]=Projection.toScreen([a[0],a[1],a[2]],b);RENDER.RAM[3]=Projection.toScreen([a[3],a[4],a[5]],b);RENDER.RAM[4]=Projection.toScreen([a[6],a[7],a[8]],b);RENDER.RAM[5]=Projection.toScreen([a[9],a[10],a[11]],b);RENDER.CONTEXT.save();RENDER.CONTEXT.beginPath();RENDER.CONTEXT.fillStyle="rgba(255,25,25,1)";RENDER.CONTEXT.moveTo(RENDER.RAM[2][0],RENDER.RAM[2][1]);RENDER.CONTEXT.lineTo(RENDER.RAM[3][0],RENDER.RAM[3][1]);RENDER.CONTEXT.lineTo(RENDER.RAM[4][0],RENDER.RAM[4][1]);
    RENDER.CONTEXT.closePath();RENDER.RAM[0]=RENDER.RAM[3][0]-RENDER.RAM[2][0];RENDER.RAM[1]=RENDER.RAM[4][1]-RENDER.RAM[2][1];0==RENDER.RAM[0]&&(RENDER.RAM[0]=1E-5);0==RENDER.RAM[1]&&(RENDER.RAM[1]=1E-5);RENDER.TEXTURE?(RENDER.CONTEXT.translate(RENDER.RAM[2][0],RENDER.RAM[2][1]),RENDER.CONTEXT.transform(1,(RENDER.RAM[3][1]-RENDER.RAM[2][1])/RENDER.RAM[0],(RENDER.RAM[4][0]-RENDER.RAM[2][0])/RENDER.RAM[1],1,0,0),RENDER.CONTEXT.scale(RENDER.RAM[0]/c.width,RENDER.RAM[1]/c.height),RENDER.CONTEXT.drawImage(c,
        0,0)):(RENDER.CONTEXT.fillStyle="#F00",RENDER.CONTEXT.fill());RENDER.CONTEXT.restore();RENDER.WIREFRAME&&(RENDER.CONTEXT.strokeStyle="#FFF",RENDER.CONTEXT.stroke());RENDER.VERTEX&&(RENDER.CONTEXT.beginPath(),RENDER.CONTEXT.strokeStyle="#F00",RENDER.CONTEXT.arc(RENDER.RAM[2][0],RENDER.RAM[2][1],3,0,2*Math.PI),RENDER.CONTEXT.stroke(),RENDER.CONTEXT.beginPath(),RENDER.CONTEXT.strokeStyle="#F00",RENDER.CONTEXT.arc(RENDER.RAM[3][0],RENDER.RAM[3][1],3,0,2*Math.PI),RENDER.CONTEXT.stroke(),RENDER.CONTEXT.beginPath(),
        RENDER.CONTEXT.strokeStyle="#F00",RENDER.CONTEXT.arc(RENDER.RAM[4][0],RENDER.RAM[4][1],3,0,2*Math.PI),RENDER.CONTEXT.stroke());RENDER.RAM[0]=0;RENDER.RAM[1]=0;RENDER.RAM[2]=0;RENDER.RAM[3]=0;RENDER.RAM[4]=0}function bias(b,a){return b/((1/a-2)*(1-b)+1)}function median(b){b.sort(function(a,b){return a-b});var a=Math.floor(b.length/2);return b.length%2?b[a]:(b[a-1]+b[a])/2}function scale(b,a){for(SPARK.RAM[1]=0;SPARK.RAM[1]<b.length;SPARK.RAM[1]+=1)b[SPARK.RAM[1]]*=a;SPARK.RAM[1]=0;return b}
function drawEntity(b,a){var c,d;d=null!=a.parent?vecAdd(a.position,a.parent.position):a.position;c=Projection.toScreen(d,b.from);if(a.img){var e=vecFromVecs(b.from,b.to);e[2]=0;e=vecRotZ(vecNorm(e),90);e=Projection.toScreen(vecAdd(e,d),b.from);d=vecDist2d(c,e)/64;var f=Math.sin(KERNAL.TIMING/100+a.rand)*vecMagnitude(a.velocity)*1.5,g=60*(1+1*Math.sin(KERNAL.TIMING/50+a.rand))*vecMagnitude(a.velocity),h=a.scale||1,k=c[0]-a.img.width/2*d*h,g=c[1]-a.img.height*d*h-g;RENDER.CONTEXT.save();RENDER.CONTEXT.translate(k+
    a.img.width*d*h/2,g+a.img.height*d*h/2);RENDER.CONTEXT.rotate(f);RENDER.CONTEXT.globalAlpha=a.opacity;RENDER.CONTEXT.drawImage(a.img,-(a.img.width*h*d/2),-(a.img.height*h*d/2),a.img.width*d*h,a.img.height*d*h);RENDER.CONTEXT.globalAlpha=1;RENDER.CONTEXT.restore();KERNAL.MOUSE_X>c[0]-a.img.width*d*h/2&&KERNAL.MOUSE_X<c[0]+a.img.width*d*h/2&&KERNAL.MOUSE_Y<c[1]&&KERNAL.MOUSE_Y>c[1]-a.img.height*d*h&&a.depth<SPARK.entity_selected[1]&&(SPARK.entity_selected[0]=a,SPARK.entity_selected[1]=a.depth)}RENDER.VERTEX&&
(RENDER.CONTEXT.beginPath(),RENDER.CONTEXT.strokeStyle="#F00",RENDER.CONTEXT.arc(c[0],c[1],3,0,2*Math.PI),RENDER.CONTEXT.stroke(),a.img&&(RENDER.CONTEXT.beginPath(),RENDER.CONTEXT.strokeStyle="#00F",RENDER.CONTEXT.arc(e[0],e[1],5,0,2*Math.PI),RENDER.CONTEXT.stroke()))}var SceneManager={children:[],update:function(){for(var b=0;b<this.children.length;b++)this.children[b].update()}};function Scene(){SceneManager.children.push(this);this.children=[]}Scene.prototype.children=[];
Scene.prototype.depthSort=function(){for(var b,a=0;a<this.children.length;a++)this.children[a]instanceof Entity&&(b=null!=this.children[a].parent?vecAdd(this.children[a].position,this.children[a].parent.position):this.children[a].position,this.children[a].depth=vecDist(b,this.camera.from));do for(b=!1,a=0;a<this.children.length-1;a++)this.children[a].depth<this.children[a+1].depth&&(b=this.children[a],this.children[a]=this.children[a+1],this.children[a+1]=b,b=!0);while(b)};
Scene.prototype.bounds=null;Scene.prototype.camera=null;Scene.prototype.appendEntity=function(b){b=new Entity;this.children.push(b);return b};Scene.prototype.appendDecal=function(b){b=new Decal;this.children.push(b);return b};
Scene.prototype.renderDecals=function(){for(var b,a=0;a<this.children.length;a+=1)this.children[a]instanceof Decal&&(b=1*this.children[a].scale,drawTri(this.camera.from,[this.children[a].position[0]-b,this.children[a].position[1]-b,0,this.children[a].position[0]-b,this.children[a].position[1]+b,0,this.children[a].position[0]+b,this.children[a].position[1]+b,0],[0,0,0,1,1,1],this.children[a].img,this.children[a].tesselate),drawTri(this.camera.from,[this.children[a].position[0]-b,this.children[a].position[1]-
b,0,this.children[a].position[0]+b,this.children[a].position[1]+b,0,this.children[a].position[0]+b,this.children[a].position[1]-b,0],[0,0,1,1,1,0],this.children[a].img,this.children[a].tesselate))};Scene.prototype.renderEntities=function(){for(var b=0;b<this.children.length;b+=1)this.children[b]instanceof Entity&&drawEntity(this.camera,this.children[b])};
Scene.prototype.update=function(){for(var b=0;b<this.children.length;b+=1){if(null!=this.children[b].path)if(2.5>vecDist(this.children[b].position,this.children[b].path))this.children[b].path=null;else if(.133>vecDist(this.children[b].velocity,[0,0,0])){var a=scale(vecFromVecs(this.children[b].path,this.children[b].position),.033);this.children[b].velocity=vecAdd(this.children[b].velocity,a)}null!=this.children[b].parent&&(this.children[b].position=vecAdd([Math.sin(this.children[b].parent.position[0]+
    this.children[b].rand),Math.cos(this.children[b].parent.position[1]+this.children[b].rand),0],this.children[b].offset));this.children[b].velocity!=[0,0,0]&&void 0!=this.children[b].velocity&&(this.children[b].velocity=vecClamp(this.children[b].velocity,.133),this.children[b].velocity=scale(this.children[b].velocity,.9),this.children[b].position=vecAdd(this.children[b].position,this.children[b].velocity))}};function Cube(){}Cube.prototype.position=[0,0,0];Cube.prototype.coords=[-1,-1,0,1,1,1];
function Entity(){}Entity.prototype.parent=null;Entity.prototype.position=[0,0,0];Entity.prototype.velocity=[0,0,0];Entity.prototype.vertices=null;Entity.prototype.triangles=null;Entity.prototype.color="333";Entity.prototype.img=null;Entity.prototype.opacity=1;Entity.prototype.name="? Entity ?";Entity.prototype.scale=1;Entity.prototype.shadow=!1;Entity.prototype.depth=0;Entity.prototype.path=null;Entity.prototype.rand=Math.random()*Math.PI;Entity.prototype.decal=null;function Decal(){}
Decal.prototype.position=[0,0,0];Decal.prototype.img=null;Decal.prototype.scale=1;Decal.prototype.depth=0;Decal.prototype.tesselate=1;function UI(){}var PageManager={children:[]};function PAGE(){PageManager.children.push(this)}PAGE.prototype.x=0;PAGE.prototype.y=0;PAGE.prototype.height=0;PAGE.prototype.width=0;PAGE.prototype.data=null;PAGE.prototype.element=null;PAGE.prototype.inDOM=!1;PAGE.prototype.isOpen=!1;function appendEntity(b,a,c){a=new Entity;a.position=c;b.push(a);return a}
SPARKDATA={LOADCACHE:0,LOADED:0};function cacheLoadImage(b){SPARKDATA.LOADCACHE+=1;item=new Image;item.src=b;item.onload=function(){SPARKDATA.LOADED+=1};return item}i_tree=cacheLoadImage("asset/sp_tree01.png");i_bush02=cacheLoadImage("asset/sp_bush02.png");i_well=cacheLoadImage("asset/sp_well.png");i_wolf=cacheLoadImage("asset/sp_npc02.png");i_doe=cacheLoadImage("asset/sp_melody.png");i_moose=cacheLoadImage("asset/sp_npc_moose.png");i_pillar01=cacheLoadImage("asset/sp_pillar01.png");i_pillar02=cacheLoadImage("asset/sp_pillar02.png");
i_flower01=cacheLoadImage("asset/sp_flower01.png");i_flower02=cacheLoadImage("asset/sp_flower02.png");i_flower03=cacheLoadImage("asset/sp_flower05.png");i_tallgrass=cacheLoadImage("asset/sp_tallgrass01.png");i_floor01=cacheLoadImage("asset/sp_floor01.png");i_shadow01=cacheLoadImage("asset/sp_shadow.png");i_leaves01=cacheLoadImage("asset/sp_leaves01.png");i_cobble01=cacheLoadImage("asset/sp_cobble01.png");i_dirt01=cacheLoadImage("asset/sp_dirtpatch01.png");var e_tree=new Entity;e_tree.img=i_tree;
e_tree.name="Tree";var pageForums=new PAGE;pageForums.data="<div class='uicenter'><div class='arbtext'><div class='col_thirdlg'><div class='forum_header colors1'>Modules</div><div class='forum_item'><div class='forum_title'>Spark World Interactive</div> Click here to launch the Spark World Interactive Module!</div></div></div></div>";
var tree={position:[0,0,0],velocity:[0,0,0],vertices:[{x:0,y:-1,z:4,u:0,v:0},{x:0,y:-1,z:0,u:0,v:1},{x:0,y:1,z:4,u:1,v:0},{x:0,y:1,z:0,u:1,v:1},{x:0,y:-1,z:0,u:0,v:1},{x:0,y:1,z:4,u:1,v:0}],triangles:[],color:"FFF",img:i_tree,name:"Tree",scale:1.5,shadow:!0,decal:i_leaves01,decal_scale:2},NOTIFY_TYPE={INFO:1,ALERT:2,TOOLTIP:3},MODE_TYPE={WAITING:0,LOADING:1,RUNNING:2,PAUSED:3,TERMINATED:4},CONSTANT={INF:999999999},KERNAL={IDENTIFIER:1,VERSION:.2,MINOR:"a",WIDTH:512,HEIGHT:256,TIMING:0,MOUSE_X:0,MOUSE_Y:0,
    MOUSE_X_PREVIOUS:0,MOUSE_Y_PREVIOUS:0,TICKS:0,GPUENABLED:!1,MODULES:[],PACKAGES:[],LOADCACHE:0},PROCESSOR={MODE:MODE_TYPE.WAITING,TASKS:[],META:{CLOCK:1,DROPPABLE:!0,MULTITHREAD:!1},RAM:[0,0,0,0]},BLOCK={},DEBUG={LOG:[],TIMING_RESULTS:[],TIMING_START:0,TIMING_TOTAL:0,TIMING_LAST:performance.now(),begin:function(){this.TIMING_RESULTS=[];this.TIMING_START=performance.now();this.TIMING_TOTAL=0},reset:function(){this.TIMING_START=performance.now()},time:function(b,a){this.TIMING_RESULTS.push({name:b,
    count:performance.now()-this.TIMING_START,color:a});this.TIMING_START=performance.now()}},MODULE=function(){this.MODE=MODE_TYPE.WAITING;this.META={HANDLE:"BASE MODULE",CLOCK:1,DROPPABLE:!0,MULTITHREAD:!1};this.init=function(){return!0};this.update=function(){return!0};this.pause=function(){return!0};this.resume=function(){return!0};this.render=function(){return!0}},GUI={MODE:MODE_TYPE.WAITING,TYPE:{DEFAULT:0,WINDOW:1},META:[]},SHIPP={MAP:[0,0,0,0]},COMPRESSOR={},WEB_INTERFACE={};
function init(){var b=document.createElement("div"),a=document.createElement("div");document.body.appendChild(b);document.body.appendChild(a);a.id="render_panel";btn_label_texture=document.createElement("div");btn_render_texture=document.createElement("input");btn_label_texture.innerHTML="Render Texture: ";btn_render_texture.type="checkbox";btn_render_texture.checked=!0;a.appendChild(btn_label_texture);a.appendChild(btn_render_texture);btn_label_vertex=document.createElement("div");btn_render_vertex=
    document.createElement("input");btn_label_vertex.innerHTML="Render Vertex: ";btn_render_vertex.type="checkbox";a.appendChild(btn_label_vertex);a.appendChild(btn_render_vertex);btn_label_wireframe=document.createElement("div");btn_render_wireframe=document.createElement("input");btn_label_wireframe.innerHTML="Render Wireframe: ";btn_render_wireframe.type="checkbox";a.appendChild(btn_label_wireframe);a.appendChild(btn_render_wireframe);btn_label_shadows=document.createElement("div");btn_render_shadows=
    document.createElement("input");btn_label_shadows.innerHTML="Render Shadows: ";btn_render_shadows.type="checkbox";btn_render_shadows.checked=!0;a.appendChild(btn_label_shadows);a.appendChild(btn_render_shadows);btn_label_decal=document.createElement("div");btn_render_decal=document.createElement("input");btn_label_decal.innerHTML="Render Decal: ";btn_render_decal.type="checkbox";btn_render_decal.checked=!0;a.appendChild(btn_label_decal);a.appendChild(btn_render_decal);btn_label_debug=document.createElement("div");
    btn_render_debug=document.createElement("input");btn_label_debug.innerHTML="Render Debug: ";btn_render_debug.type="checkbox";btn_render_debug.checked=!1;a.appendChild(btn_label_debug);a.appendChild(btn_render_debug);ctrls=document.createElement("div");ctrls.innerHTML="<h2>Controls:</h2>WASD / Left Mouse Click: <strong>Move</strong><br />Middle Mouse Wheel: <strong>Camera Zoom</strong><br />Right Mouse Click & Drag: <strong>Rotate Camera</strong>";a.appendChild(ctrls);prepareEvents();for(PROCESSOR.RAM[0]in KERNAL.MODULES)KERNAL.MODULES[PROCESSOR.RAM[0]].init(),
        KERNAL.MODULES[PROCESSOR.RAM[0]].MODE=MODE_TYPE.RUNNING,PROCESSOR.RAM[1]=document.createElement("div"),PROCESSOR.RAM[1].innerHTML=KERNAL.MODULES[PROCESSOR.RAM[0]].META.HANDLE+" has initiated.",b.appendChild(PROCESSOR.RAM[1]),PROCESSOR.RAM[1]=0;PROCESSOR.RAM[0]=0;logic()}
function logic(){requestUpdate(logic);DEBUG.begin();KERNAL.TICKS+=1;KERNAL.TIMING=performance.now();update();render();KERNAL.MOUSE_X_PREVIOUS=KERNAL.MOUSE_X;KERNAL.MOUSE_Y_PREVIOUS=KERNAL.MOUSE_Y;RENDER.DEBUG.SHOW&&(DEBUG.TIMING_TOTAL=DEBUG.TIMING_RESULTS.reduce(function(b,a){return b+a.count},0),DEBUG.TIMING_RESULTS.push({name:"free",count:1E3/60/2-DEBUG.TIMING_TOTAL,color:"#FFFF8E"}),DEBUG.TIMING_TOTAL=DEBUG.TIMING_RESULTS.reduce(function(b,a){return b+a.count},0),PROCESSOR.RAM[1]=-.5*Math.PI,PROCESSOR.RAM[0]=
    0,DEBUG.TIMING_RESULTS.forEach(function(b){PROCESSOR.RAM[2]=b.count/DEBUG.TIMING_TOTAL*2*Math.PI;RENDER.CONTEXT.beginPath();RENDER.CONTEXT.arc(164,164,100,PROCESSOR.RAM[1],PROCESSOR.RAM[1]+PROCESSOR.RAM[2]);PROCESSOR.RAM[1]+=PROCESSOR.RAM[2];RENDER.CONTEXT.lineTo(164,164);RENDER.CONTEXT.fillStyle=b.color;RENDER.CONTEXT.fill();RENDER.CONTEXT.beginPath();RENDER.CONTEXT.textBaseline="bottom";RENDER.CONTEXT.textAlign="left";RENDER.CONTEXT.font="bold 13px courier";RENDER.CONTEXT.fillText(b.name+": "+b.count+
    "ms",64,290+24*PROCESSOR.RAM[0]);RENDER.CONTEXT.fill();PROCESSOR.RAM[0]+=1}),PROCESSOR.RAM[0]+=1,RENDER.CONTEXT.beginPath(),RENDER.CONTEXT.textBaseline="bottom",RENDER.CONTEXT.textAlign="left",RENDER.CONTEXT.font="bold 13px courier",RENDER.CONTEXT.fillText("RENDER TEXTURE TRANSFORM COUNT: "+RENDER.DEBUG.TRIS+"tris",64,290+24*PROCESSOR.RAM[0]),PROCESSOR.RAM[0]+=1,RENDER.CONTEXT.textBaseline="bottom",RENDER.CONTEXT.textAlign="left",RENDER.CONTEXT.font="bold 13px courier",RENDER.CONTEXT.fillText("TOTAL FRAME TIME: "+
    (performance.now()-DEBUG.TIMING_LAST)+"ms",64,290+24*PROCESSOR.RAM[0]),RENDER.CONTEXT.fill(),PROCESSOR.RAM[0]+=1);DEBUG.TIMING_LAST=performance.now()}function update(){for(PROCESSOR.RAM[0]in KERNAL.MODULES)KERNAL.MODULES[PROCESSOR.RAM[0]].update();PROCESSOR.RAM[0]=0}function render(){for(PROCESSOR.RAM[0]in KERNAL.MODULES)KERNAL.MODULES[PROCESSOR.RAM[0]].render();PROCESSOR.RAM[0]=0}var RENDER=new MODULE;RENDER.META.HANDLE="CANVAS RENDER MODULE";
RENDER.init=function(){this.RAM=[0,0,0,0,0,0];try{return this.WIDTH=window.innerWidth,this.HEIGHT=window.innerHeight,this.CANVAS=document.createElement("canvas"),this.CANVAS.id="drawCanvas",this.CANVAS.width=this.WIDTH,this.CANVAS.height=this.HEIGHT,this.TEXTURE=this.COLORED=this.WIREFRAME=!0,this.AMBIENT=this.LIGHTING=!1,this.OVERDRAW=0,this.SHADOWS=this.VERTEX=!1,this.DECALS=!0,this.DEBUG={TRIS:0,SHOW:!1},document.body.appendChild(this.CANVAS),this.CONTEXT=this.CANVAS.getContext("2d"),this.CONTEXT.mozImageSmoothingEnabled=
    !1,this.CONTEXT.webkitImageSmoothingEnabled=!1,this.CONTEXT.msImageSmoothingEnabled=!1,this.CONTEXT.imageSmoothingEnabled=!1,!0}catch(b){return!1}};RENDER.update=function(){this.TEXTURE=btn_render_texture.checked;this.VERTEX=btn_render_vertex.checked;this.WIREFRAME=btn_render_wireframe.checked;this.SHADOWS=btn_render_shadows.checked;this.DECALS=btn_render_decal.checked;this.DEBUG.SHOW=btn_render_debug.checked;this.DEBUG.TRIS=0};var LANDING=new MODULE;LANDING.META.HANDLE="LANDING MODULE";
LANDING.init=function(){this.text_pos=[[0,0],[0,0]];this.site_color="#f2e379 #ca8d37 #97d779 #439f79 #77bcf0 #4b4ac2 #c49ee5 #653683 #eb5586 #91295a".split(" ");this.site_color_index=2*Math.floor(LANDING.site_color.length/2*Math.random());LANDING.site_color_index+=2;LANDING.site_color_index%=LANDING.site_color.length;var b=LANDING.site_color[LANDING.site_color_index],a=document.getElementsByTagName("*"),c;for(c in a)-1<(" "+a[c].className+" ").indexOf(" nava ")&&(a[c].style.backgroundColor=b);this.isOpen=
    !0;this.elemHeight=0;this.element=document.getElementById("page");for(b=0;b<PageManager.children.length;b+=1)PageManager.children[b].inDOM||(PageManager.children[b].inDOM=!0,PageManager.children[b].element=document.createElement("div","node"+b),PageManager.children[b].element.style.top=PageManager.children[b].y+"px",this.element.appendChild(PageManager.children[b].element)),PageManager.children[b].element.innerHTML=PageManager.children[b].data};
LANDING.update=function(){key[27]&&(this.isOpen=!this.isOpen,key[27]=!1);this.elemWidth=RENDER.WIDTH-24-24;this.elemHeight=this.isOpen?this.elemHeight+(RENDER.HEIGHT-24-1-24-72-this.elemHeight)/12:this.elemHeight+(0-this.elemHeight)/12;this.element.style.height=""+Math.floor(this.elemHeight)+"px";this.element.style.width=""+Math.floor(this.elemWidth)+"px";for(var b=0;b<PageManager.children.length;b+=1);};LANDING.render=function(){};var SPARK=new MODULE;SPARK.META.HANDLE="SPARK MODULE";
SPARK.init=function(){this.camera={from:[0,16,16],to:[0,0,0],up:[0,0,1],fov:45,aspect:RENDER.WIDTH/RENDER.HEIGHT,zoom:[2,2],rotation:[0,-45,0],rotationVelocity:[0,0,0],position:[1,0,0]};this.texGrass=new Image;this.texGrass.src="asset/sp_floor01.png";this.isLanding=!1;this.RAM=[0,0,0,0,0,0];this.SPARK_SCENE=new Scene;this.area01=new Scene;this.area01.camera=this.camera;this.entity_selected=[null,CONSTANT.INF];var b,a,c=48;for(this.RAM[0]=0;64>this.RAM[0];this.RAM[0]+=1)b=this.area01.appendEntity(),
    b.position=[-c+2*Math.random()*c,-c+2*Math.random()*c,0],b.img=i_tree,b.name="Tree",b.scale=1.5+.5*Math.random(),2>10*Math.random()&&(a=this.area01.appendDecal(),a.img=i_leaves01,a.position=b.position,a.scale=2,a.tesselate=99);c=48;for(this.RAM[0]=0;64>this.RAM[0];this.RAM[0]+=1)b=this.area01.appendEntity(),b.position=[-c+2*Math.random()*c,-c+2*Math.random()*c,0],b.img=i_flower01,b.name="Flower",b.scale=1.5+.5*Math.random();c=48;for(this.RAM[0]=0;12>this.RAM[0];this.RAM[0]+=1)b=this.area01.appendEntity(),
    b.position=[-c+2*Math.random()*c,-c+2*Math.random()*c,0],b.img=i_pillar01,b.name="Pillar",b.scale=1.5+.5*Math.random();c=48;for(this.RAM[0]=0;12>this.RAM[0];this.RAM[0]+=1);b=this.area01.appendDecal();b.img=i_floor01;b.scale=16;b.depth=1;b.tesselate=0;b=-6+12*Math.random();a=-6+12*Math.random();this.control_object=this.area01.appendEntity();this.control_object.position=[b,a,0];this.control_object.img=i_wolf;this.control_object.name="Wolf";this.control_object.scale=2;b=-6+12*Math.random();a=-6+12*
    Math.random();this.doe=this.area01.appendEntity();this.doe.position=[b,a,0];this.doe.img=i_doe;this.doe.name="Doe";this.doe.scale=.5;b=-6+12*Math.random();a=-6+12*Math.random();this.moose=this.area01.appendEntity();this.moose.position=[b,a,0];this.moose.img=i_moose;this.moose.name="Moose";this.moose.scale=.5;window.addEventListener("mousewheel",function(a){a=window.event||a;SPARK.camera.zoom[1]-=Math.max(-1,Math.min(1,a.wheelDelta||-a.detail))})};
SPARK.update=function(){for(this.RAM[0]=0;this.RAM[0]<SceneManager.children.length;this.RAM[0]+=1)SceneManager.children[this.RAM[0]].depthSort();DEBUG.time("SPARK: Depth Sort","#18BC9A");if(!LANDING.isOpen){if(.133>vecDist(this.control_object.velocity,[0,0,0])){if(key[65]){var b=scale(vecFromVecs(this.camera.to,this.camera.from),.033);b[2]=0;this.control_object.velocity=vecAdd(this.control_object.velocity,vecRotZ(b,270))}else key[68]&&(b=scale(vecFromVecs(this.camera.to,this.camera.from),.033),b[2]=
    0,this.control_object.velocity=vecAdd(this.control_object.velocity,vecRotZ(b,90)));key[83]?(b=scale(vecFromVecs(this.camera.from,this.camera.to),.033),b[2]=0,this.control_object.velocity=vecAdd(this.control_object.velocity,b)):key[87]&&(b=scale(vecFromVecs(this.camera.to,this.camera.from),.033),b[2]=0,this.control_object.velocity=vecAdd(this.control_object.velocity,b))}this.doe.path=this.control_object.position;this.moose.path=this.doe.position}SceneManager.update();DEBUG.time("SPARK: Update","#5cdfac");
    this.entity_selected=[null,CONSTANT.INF]};
SPARK.render=function(){DEBUG.reset();this.camera.aspect=RENDER.WIDTH/RENDER.HEIGHT;SPARK.camera.zoom[1]=median([.62,SPARK.camera.zoom[1],10]);SPARK.camera.zoom[0]+=(SPARK.camera.zoom[1]-SPARK.camera.zoom[0])/8;!LANDING.isOpen&&mouseButton[2]&&(this.camera.rotationVelocity[0]-=(KERNAL.MOUSE_X_PREVIOUS-KERNAL.MOUSE_X)/16,this.camera.rotationVelocity[1]+=(KERNAL.MOUSE_Y_PREVIOUS-KERNAL.MOUSE_Y)/16);this.camera.rotationVelocity=scale(this.camera.rotationVelocity,.92);this.camera.rotation[0]+=this.camera.rotationVelocity[0];
    this.camera.rotation[1]+=this.camera.rotationVelocity[1];this.camera.rotation[1]=median([-62,this.camera.rotation[1],-7]);this.camera.from=vecRotY(this.camera.position,this.camera.rotation[1]);this.camera.from=vecRotZ(this.camera.from,this.camera.rotation[0]);this.camera.from=scale(this.camera.from,16*this.camera.zoom[0]);this.camera.to=this.control_object.position;this.camera.from=[this.camera.to[0]+this.camera.from[0],this.camera.to[1]+this.camera.from[1],this.camera.to[2]+this.camera.from[2]];
    this.camera.to=[this.control_object.position[0],this.control_object.position[1],this.control_object.position[2]];Projection.set(this.camera.from,this.camera.to,this.camera.up,this.camera.fov,this.camera.aspect);DEBUG.time("SPARK: Render Setup","#f1c30b");debugGrid(RENDER.CONTEXT,RENDER.WIDTH,RENDER.HEIGHT,48);DEBUG.time("SPARK: Render Debug","#f39c0e");DEBUG.time("SPARK: Render Floor","#9a59b5");if(RENDER.DECALS){RENDER.CONTEXT.save();for(this.RAM[0]=0;this.RAM[0]<SceneManager.children.length;this.RAM[0]+=
        1)SceneManager.children[this.RAM[0]].renderDecals();RENDER.CONTEXT.restore()}DEBUG.time("SPARK: Render Decals","#f1c30b");DEBUG.time("SPARK: Render Shadows","#5cacdf");for(this.RAM[0]=0;this.RAM[0]<SceneManager.children.length;this.RAM[0]+=1)SceneManager.children[this.RAM[0]].renderEntities();LANDING.isOpen||null==this.entity_selected[0]||(drawTextBox(RENDER.CONTEXT,this.entity_selected[0].name.toLowerCase(),24,"#000",KERNAL.MOUSE_X,KERNAL.MOUSE_Y-48,8),mouseButton[1]&&(this.control_object.path=this.entity_selected[0].position));
    DEBUG.time("SPARK: Render Entities","#12a185");if(SPARKDATA.LOADCACHE!=SPARKDATA.LOADED||this.isLanding)RENDER.CONTEXT.beginPath(),RENDER.CONTEXT.fillStyle="rgba(67,74,89,0.76)",RENDER.CONTEXT.fillRect(0,0,RENDER.WIDTH,RENDER.HEIGHT),RENDER.CONTEXT.fill(),SPARKDATA.LOADCACHE!=SPARKDATA.LOADED&&(RENDER.CONTEXT.beginPath(),RENDER.CONTEXT.strokeStyle="rgba(25,25,25,0.76)",RENDER.CONTEXT.moveTo(RENDER.WIDTH/2-128,RENDER.HEIGHT/2),RENDER.CONTEXT.lineTo(RENDER.WIDTH/2+128,RENDER.HEIGHT/2),RENDER.CONTEXT.stroke(),
        RENDER.CONTEXT.beginPath(),RENDER.CONTEXT.strokeStyle="#FFF",RENDER.CONTEXT.moveTo(RENDER.WIDTH/2-128,RENDER.HEIGHT/2+.5),RENDER.CONTEXT.lineTo(RENDER.WIDTH/2-128+SPARKDATA.LOADED/SPARKDATA.LOADCACHE*256,RENDER.HEIGHT/2+.5),RENDER.CONTEXT.stroke(),drawText(RENDER.CONTEXT,"loading2..",48,"#FFF",RENDER.WIDTH/2,RENDER.HEIGHT/2-96))};KERNAL.MODULES.push(RENDER);KERNAL.MODULES.push(SPARK);init();